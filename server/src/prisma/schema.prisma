generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Park {
  park_id       Int       @id(map: "Parks_pkey") @default(autoincrement())
  name          String    @db.VarChar(150)
  county        String    @db.VarChar(150)
  is_active     Boolean   @default(true)
  created_at    DateTime  @default(now())

  trails        Trail[]
  issues        Issue[]
}

model Trail {
  trail_id       Int       @id @default(autoincrement())
  park_id        Int
  name           String    @db.VarChar(150)
  is_active      Boolean   @default(true)
  is_open        Boolean
  created_at     DateTime  @default(now())

  issues        Issue[]

  //Foreign key relation to Park
  park Park @relation(fields: [park_id], references: [park_id])
}

model Issue {
  issue_id        Int        @id @default(autoincrement())
  park_id         Int
  trail_id        Int
  is_public       Boolean
  status          String
  description     String?    @db.VarChar(150)
  issue_type      String     @db.VarChar(150)
  urgency         Int
  issue_image     String?    @db.VarChar(150)
  notify_reporter Boolean
  reporter_email  String     @db.VarChar(150)
  longitude       Float?
  latitude        Float?
  created_at      DateTime   @default(now())
  resolved_at     DateTime?

  notifications Notification[]

  //Foreign Key in relation to Parks and Trails
  park  Park  @relation(fields: [park_id], references: [park_id])
  trail Trail @relation(fields: [trail_id], references: [trail_id])
}

model User {
  user_id       Int       @id @default(autoincrement())
  username      String    @unique @db.VarChar(100)
  is_admin      Boolean
  permission    String
  profile_image String    @db.VarChar
  email         String    @unique @db.VarChar(100)
  is_active     Boolean
  created_at      DateTime   @default(now())
}

model Notification {
  notification_id Int        @id @default(autoincrement())
  issue_id        Int
  recipient_email String
  content         String     @db.VarChar(150)
  sent_at         DateTime? 
  created_at      DateTime   @default(now())

  //Foreign Key in relation to Users
  user Issue @relation(fields: [issue_id], references: [issue_id])
}
