generator client {
  provider        = "prisma-client-js"
  useDefine       = true
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum IssueStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum IssueType {
  OBSTRUCTION
  EROSION
  FLOODING
  SIGNAGE
  VANDALISM
  OTHER
}

enum UserRole {
  ROLE_USER
  ROLE_ADMIN
  ROLE_SUPERADMIN
}

enum Urgency {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

model Park {
  parkId    Int      @id(map: "Parks_pkey") @default(autoincrement()) @map("park_id")
  name      String   @db.VarChar(50)
  county    String   @db.VarChar(50)
  isActive  Boolean  @default(true)         @map("is_active")
  createdAt DateTime @default(now())        @map("created_at")

  trails Trail[]
  issues Issue[]
}

model Trail {
  trailId   Int      @id @default(autoincrement()) @map("trail_id")
  parkId    Int                                    @map("park_id")
  name      String   @db.VarChar(100)
  isActive  Boolean  @default(true)                @map("is_active")
  isOpen    Boolean  @default(true)                @map("is_open")
  createdAt DateTime @default(now())               @map("created_at")

  park   Park   @relation(fields: [parkId], references: [parkId])
  issues Issue[]
}

model Issue {
  issueId        Int         @id @default(autoincrement())        @map("issue_id")
  parkId         Int                                              @map("park_id")
  trailId        Int                                              @map("trail_id")
  isPublic       Boolean                                          @map("is_public")
  status         IssueStatus @default(OPEN)
  description    String?     @db.VarChar(450)
  issueType      IssueType                                        @map("issue_type")
  urgency        Urgency
  issueImage     String?     @db.VarChar(150)                     @map("issue_image")
  notifyReporter Boolean     @default(false)                      @map("notify_reporter")
  reporterEmail  String      @db.VarChar(150)                     @map("reporter_email")
  longitude      Float?
  latitude       Float?
  createdAt      DateTime    @default(now())                      @map("created_at")
  resolvedAt     DateTime?                                        @map("resolved_at")

  park           Park        @relation(fields: [parkId], references: [parkId])
  trail          Trail       @relation(fields: [trailId], references: [trailId])
  notifications  Notification[]
}

model User {
  userId       Int             @id @default(autoincrement())  @map("user_id")
  username     String          @unique @db.VarChar(100)
  role         UserRole        @default(ROLE_USER)
  profileImage String          @db.VarChar                    @map("profile_image")
  email        String          @unique @db.VarChar(100)
  isActive     Boolean                                        @map("is_active")
  createdAt    DateTime        @default(now())                @map("created_at")
}

model Notification {
  notificationId Int         @id @default(autoincrement())   @map("notification_id")
  issueId        Int                                         @map("issue_id")
  recipientEmail String                                      @map("recipient_email")
  content        String      @db.VarChar(150)
  sentAt         DateTime?                                   @map("sent_at")
  createdAt      DateTime    @default(now())                 @map("created_at")

  user Issue @relation(fields: [issueId], references: [issueId])
}