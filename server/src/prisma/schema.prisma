generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Trail {
  trail_id  Int      @id @default(autoincrement())
  park_id   Int
  name      String   @db.VarChar(150)
  is_active Boolean
  is_open   Boolean
  issues    Issue[]

  //Foreign key relation to Park
  park Park @relation(fields: [park_id], references: [park_id])
}

model User {
  user_id                  Int       @id @default(autoincrement())
  name                     String    @unique @db.VarChar(100)
  is_admin                 Boolean
  is_hubspot_user          Boolean
  profile_image_key        String    @db.VarChar
  email                    String    @unique @db.VarChar(100)
  created_at               DateTime? @default(now())
  is_active                Boolean

  //Relation: one user can have multiple permissions
  permissions   Permission[]
  notifications Notification[]
}

model Park {
  park_id   Int     @id(map: "Parks_pkey") @default(autoincrement())
  name      String  @db.VarChar(150)
  county    String  @db.VarChar(150)
  is_active Boolean @default(true)

  trails      Trail[]
  issues      Issue[]
  permissions Permission[]
}

model Permission {
  permission_id   Int       @id @default(autoincrement())
  user_id         Int
  resource_type   String    @db.VarChar(150)
  resource_id     Int
  permission_type String    @db.VarChar(150)
  assigned_date   DateTime? @default(now())
  is_active       Boolean

  //Foreign Key in relation to Users
  user User @relation(fields: [user_id], references: [user_id])
  park Park @relation(fields: [resource_id], references: [park_id])
}

model Issue {
  issue_id        Int       @id @default(autoincrement())
  park_id         Int
  trail_id        Int
  is_public       Boolean
  status          String    @db.VarChar(150)
  description     String    @db.VarChar(150)
  created_at      DateTime? @default(now())
  issue_type      String    @db.VarChar(150)
  urgency         Int
  issue_image     String?    @db.VarChar(150)
  notify_reporter Boolean
  resolved_at     DateTime? @default(now())

  //Foreign Key in relation to Parks and Trails
  park  Park  @relation(fields: [park_id], references: [park_id])
  trail Trail @relation(fields: [trail_id], references: [trail_id])
}

model Notification {
  notification_id Int    @id @default(autoincrement())
  recipient_id    Int
  content         String @db.VarChar(150)

  //Foreign Key in relation to Users
  user User @relation(fields: [recipient_id], references: [user_id])
}

model Anonymous_user {
  id     Int    @id @default(autoincrement())
  email  String @unique
  status String @db.VarChar(150)
}
